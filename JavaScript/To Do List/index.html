<!DOCTYPE html>
<html>
    <head>
        <title>To Do List</title>

        <link href = "style.css" rel = "stylesheet" type = "text/css">

        <script src = "Lista.js" type = "text/javascript"></script>
        <script src = "ToDo.js" type = "text/javascript"></script>
        <script type = "text/javascript">
            const lista = new Lista();

            aggiornaPagina();

            function aggiungi() {
                // la lista è piena
                if (lista.getLength() == 10) {
                    alert("Lista piena!");
                    return;
                }
                // le caselle dei dati sono vuote
                if (document.getElementById('oggetto').value == '' || document.getElementById('data').value == '') {
                    alert("Inserire i dati!");
                    return;
                }

                let oggetto = document.getElementById('oggetto').value;
                const data = new Date(document.getElementById('data').value);

                const toDo = new ToDo(oggetto, data);
                lista.aggiungiToDo(toDo);

                aggiornaPagina();
            }

            function modifica() {
                // se le modifiche sono vuote
                if (document.getElementById('oggetto').value == '' || document.getElementById('data').value == '') {
                    alert("Inserire le modifiche!");
                    return;
                }

                for (let i = 0; i < lista.getLength(); i++) {
                    // modifica se l'elemento è selezionato
                    if (document.getElementById('toDo' + i).style.backgroundColor == "rgb(207, 207, 207)") {
                        const data = new Date(document.getElementById('data').value);
                        lista.modificaToDo(i, document.getElementById('oggetto').value, data);
                    }
                }

                aggiornaPagina();
            }

            function elimina(posizione) {
                pulisciPagina();

                lista.rimuovi(posizione);

                aggiornaPagina();
            }

            function eliminaSelezionati() {
                pulisciPagina();

                for (let i = 0; i < lista.getLength(); i++) {
                    if (document.getElementById('toDo' + i).style.backgroundColor == "rgb(207, 207, 207)") 
                        lista.rimuovi(i);
                }

                aggiornaPagina();
            }

            // cambia lo stato della checkbox
            function cambiaStatoCasella(posizione) {
                //inverte lo sttao di completamento della to do
                if (lista.getStatoToDo(posizione) == 'incompletata') 
                    lista.setStatoToDo(posizione, 'completata');
                else 
                    lista.setStatoToDo(posizione, 'incompletata');
                
                aggiornaPagina();
            }

            // ordina e visualizza gli elementi per stato
            function visualizzaPerStato() {
                pulisciPagina();

                lista.ordinaPerStato();
                // aggiorna la grafica
                aggiornaPagina();
            }

            // ordina e visualizza gli elementi per data
            function visualizzaPerData() {
                lista.ordinaPerData();
                // aggiorna la grafica
                aggiornaPagina();
            }

            // mostra o nasconde le scadenze cui mancano meno di 3 giorni
            function mostraNascondiUrgenti() {
                // se vuole nascondere 
                if (document.getElementById('mostraNascondi').value == "NASCONDI ATTIVITA' URGENTI") {
                    for (let i = 0; i < lista.getLength(); i++) {
                        // se l'elemento è in scadenza
                        if (lista.inScadenza(i) === true) 
                            // lo nasconde
                            document.getElementById('toDo' + i).style.display = "none";
                    }
                    // inverte il contenuto del bottone 
                    document.getElementById('mostraNascondi').value = "MOSTRA ATTIVITA' URGENTI";
                }
                // se vuole mostrare 
                else {
                    for (let i = 0; i < lista.getLength(); i++) {
                        // se l'elemento è in scadenza
                        if (lista.inScadenza(i) === true) 
                            // lo mostra
                            document.getElementById('toDo' + i).style.display = "block";
                    }
                    // inverte il contenuto del bottone 
                    document.getElementById('mostraNascondi').value = "NASCONDI ATTIVITA' URGENTI";
                }
            }

            // cambia lo stato di selezione del singolo elemento della lista
            function selDesel(posizione) {
                // se non è selezionato
                if (document.getElementById('toDo' + posizione).style.backgroundColor == "") 
                    // lo seleziona
                    document.getElementById('toDo' + posizione).style.backgroundColor = "rgb(207, 207, 207)";
                else
                    // altrimenti lo deseleziona
                    document.getElementById('toDo' + posizione).style.backgroundColor = "";
                
                // controllo che almeno un elemento sia selezionato per mostrare il pulsante "seleziona tutti"
                for (let i = 0; i < lista.getLength(); i++) {
                    if (document.getElementById('toDo' + i).style.backgroundColor == "rgb(207, 207, 207)") {
                        document.getElementById('aggiungi').style.display = "none";
                        document.getElementById('selezionati').style.display = "block";
                        return;
                    }
                } 
                
                aggiornaPagina();
            }

            // cambia lo stato di selezione di tutti gli elementi della lista
            function selDeselTutti() {
                if (document.getElementById('selDeselTutti').value == "SELEZIONA TUTTI") {
                    for (let i = 0; i < lista.getLength(); i++) 
                        document.getElementById('toDo' + i).style.backgroundColor = "rgb(207, 207, 207)";
                    // inverte il contenuto del bottone
                    document.getElementById('selDeselTutti').value = "DESELEZIONA TUTTI";
                } else {
                    for (let i = 0; i < lista.getLength(); i++) 
                        document.getElementById('toDo' + i).style.backgroundColor = "";
                    document.getElementById('selDeselTutti').value = "SELEZIONA TUTTI";
                    document.getElementById('aggiungi').style.display = "block";
                    document.getElementById('selezionati').style.display = "none";
                }
            }

            // ripulisce la pagina 
            function pulisciPagina() {
                for (let i = 0; i < lista.getLength(); i++) {
                    document.getElementById('toDo' + i).style.display = "none";
                }
            }

            // ricarica la pagina
            function aggiornaPagina() {
                if (lista.getLength() == 0) {
                    document.getElementById('ordinaData').disabled = true;
                    document.getElementById('ordinaStato').disabled = true;
                    document.getElementById('mostraNascondi').disabled = true;
                }
                else {
                    document.getElementById('ordinaData').disabled = false;
                    document.getElementById('ordinaStato').disabled = false;
                    document.getElementById('mostraNascondi').disabled = false;
                }

                for (let i = 0; i < lista.getLength(); i++) {
                    document.getElementById('oggetto' + i).innerHTML = lista.getOggettoToDo(i);
                    document.getElementById('data' + i).innerHTML = lista.getDataToDo(i);
                    document.getElementById('toDo' + i).style.backgroundColor = "";
                    document.getElementById('toDo' + i).style.display = "block";

                    if (lista.getStatoToDo(i) == 'incompletata') {
                        document.getElementById('casella' + i).checked = false;
                        document.getElementById('oggetto' + i).style.textDecoration = "none";
                        document.getElementById('data' + i).style.textDecoration = "none";
                    }
                    else  {
                        document.getElementById('casella' + i).checked = true;
                        document.getElementById('oggetto' + i).style.textDecoration = "line-through";
                        document.getElementById('data' + i).style.textDecoration = "line-through";
                    }
                }

                document.getElementById('selezionati').style.display = "none";
                document.getElementById('aggiungi').style.display = "block";
            }
        </script>
    </head>

    <body>
        <h2>TO DO LIST</h2>
        
        <table>
            <tr id = "ordina">
                <td class = "ordina">Ordina per</td>
                <td class = "ordina"><input type = "button" class = "ordina" id = "ordinaData" value = "DATA" onclick = "visualizzaPerData()" disabled></td>
                <td class = "ordina"><input type = "button" class = "ordina" id = "ordinaStato" value = "STATO" onclick = "visualizzaPerStato()" disabled></td>
            </tr>

            <tr>
                <td><input type = "button" id = "mostraNascondi" value = "NASCONDI ATTIVITA' URGENTI" onclick = "mostraNascondiUrgenti()" disabled></td>
            </tr>

            <tr>
                <td><input type = "text" id = "oggetto"></td>
                <td><input type = "date" id = "data"></td>
                <td><input type = "button" id = "aggiungi" value = "AGGIUNGI" onclick = "aggiungi()"></td>
            </tr>

            <tr id = "selezionati">
                <td><input type = "button" id = "modifica" value = "MODIFICA" onclick = "modifica()"></td>
                <td><input type = "button" id = "selDeselTutti" value = "SELEZIONA TUTTI" onclick = "selDeselTutti()"></td>
                <td><input type = "button" class = "elimina" id = "eliminaSelezionati" value = "ELIMINA SELEZIONATI" onclick = "eliminaSelezionati()"></td>
            </tr>

            <tr class = "elementoLista" id = "toDo0" onclick = "selDesel(0)">
                <td><input type = "checkbox" id = "casella0" onclick = "cambiaStatoCasella(0)"></td>
                <td><p id = "oggetto0"></p></td>
                <td><p id = "data0"></p></td>
                <td><input type = "button" class = "elimina" id = "b1" value = "ELIMINA" onclick = "elimina(0)"></td>
            </tr>

            <tr class = "elementoLista" id = "toDo1" onclick = "selDesel(1)">
                <td><input type = "checkbox" id = "casella1" onclick = "cambiaStatoCasella(1)"></td>
                <td><p id = "oggetto1"></p></td>
                <td><p id = "data1"></p></td>
                <td><input type = "button" class = "elimina" id = "b1" value = "ELIMINA" onclick = "elimina(1)"></td>
            </tr>

            <tr class = "elementoLista" id = "toDo2" onclick = "selDesel(2)">
                <td><input type = "checkbox" id = "casella2" onclick = "cambiaStatoCasella(2)"></td>
                <td><p id = "oggetto2"></p></td>
                <td><p id = "data2"></p></td>
                <td><input type = "button" class = "elimina" id = "b2" value = "ELIMINA" onclick = "elimina(2)"></td>
            </tr>

            <tr class = "elementoLista" id = "toDo3" onclick = "selDesel(3)">
                <td><input type = "checkbox" id = "casella3" onclick = "cambiaStatoCasella(3)"></td>
                <td><p id = "oggetto3"></p></td>
                <td><p id = "data3"></p></td>
                <td><input type = "button" class = "elimina" id = "b3" value = "ELIMINA" onclick = "elimina(3)"></td>
            </tr>

            <tr class = "elementoLista" id = "toDo4" onclick = "selDesel(4)">
                <td><input type = "checkbox" id = "casella4" onclick = "cambiaStatoCasella(4)"></td>
                <td><p id = "oggetto4"></p></td>
                <td><p id = "data4"></p></td>
                <td><input type = "button" class = "elimina" id = "b4" value = "ELIMINA" onclick = "elimina(4)"></td>
            </tr>

            <tr class = "elementoLista" id = "toDo5" onclick = "selDesel(5)">
                <td><input type = "checkbox" id = "casella5" onclick = "cambiaStatoCasella(5)"></td>
                <td><p id = "oggetto5"></p></td>
                <td><p id = "data5"></p></td>
                <td><input type = "button" class = "elimina" id = "b5" value = "ELIMINA" onclick = "elimina(5)"></td>
            </tr>

            <tr class = "elementoLista" id = "toDo6" onclick = "selDesel(6)">
                <td><input type = "checkbox" id = "casella6" onclick = "cambiaStatoCasella(6)"></td>
                <td><p id = "oggetto6"></p></td>
                <td><p id = "data6"></p></td>
                <td><input type = "button" class = "elimina" id = "b6" value = "ELIMINA" onclick = "elimina(6)"></td>
            </tr>

            <tr class = "elementoLista" id = "toDo7" onclick = "selDesel(7)">
                <td><input type = "checkbox" id = "casella7" onclick = "cambiaStatoCasella(7)"></td>
                <td><p id = "oggetto7"></p></td>
                <td><p id = "data7"></p></td>
                <td><input type = "button" class = "elimina" id = "b7" value = "ELIMINA" onclick = "elimina(7)"></td>
            </tr>

            <tr class = "elementoLista" id = "toDo8" onclick = "selDesel(8)">
                <td><input type = "checkbox" id = "casella8" onclick = "cambiaStatoCasella(8)"></td>
                <td><p id = "oggetto8"></p></td>
                <td><p id = "data8"></p></td>
                <td><input type = "button" class = "elimina" id = "b8" value = "ELIMINA" onclick = "elimina(8)"></td>
            </tr>

            <tr class = "elementoLista" id = "toDo9" onclick = "selDesel(9)">
                <td><input type = "checkbox" id = "casella9" onclick = "cambiaStatoCasella(9)"></td>
                <td><p id = "oggetto9"></p></td>
                <td><p id = "data9"></p></td>
                <td><input type = "button" class = "elimina" id = "b9" value = "ELIMINA" onclick = "elimina(9)"></td>
            </tr>
        </table>
    </body>
</html>